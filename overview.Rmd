---
title: "Overview"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: cerulean
---
#Overview

Below, we have described the demographics of the perpetrators and the victims, including age group and race/ethnicity. Of note, these data included many NA entries. We see that most victims and perpetrators were aged 18-44 years, were of black race, with a high number of incidents with black male perpetrators and victims [need to check with Jen that I am interpreting her description correctly]. For the purposes of simplifying race/ethnicity categorization, we lumped white Hispanic and black Hispanic individuals into a single category titled â€œHispanicâ€.
 
[need to create a table]


```{r setup, include = FALSE}
library(tidyverse)
library(patchwork)
library(plotly)
library(leaflet)

knitr::opts_chunk$set(
echo = TRUE,
warning = FALSE,
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%")

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis")

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

```{r}
nypd_shooting_df = 
  read_csv("data/nypd_shooting_data.csv") %>%
  janitor::clean_names() %>%
  separate(col = occur_date, into = c("month", "day", "year"), sep = "/") %>% 
  separate(col = occur_time, into = c("hour", "minute", "second"), sep = ":") %>%
  mutate(across(where(is.character), tolower),
         month = as.numeric(month),
         month_name = recode(month, "1" = "january", "2" = "february", "3" = "march", "4" = "april", "5" = "may", "6" = "june", "7" = "july", "8" = "august", "9" = "september", "10" = "october", "11" = "november", "12" = "december"),
         day = as.numeric(day),
         year = as.numeric(year), 
         hour = as.numeric(hour),
         minute = as.numeric(minute), 
         second = as.numeric(second),
         minute_calc = hour * 60 + minute,
         boro = as.factor(boro), 
         boro = fct_relevel(boro, "manhattan", "brooklyn", "bronx", "queens", "staten island")) %>%
  select(incident_key, year, month_name, month, day, hour, minute, second, minute_calc, everything())
```

```{r}
nypd_shooting_df %>%
  mutate(
    perp_age_group = na_if(perp_age_group, 1020),
    perp_age_group = na_if(perp_age_group, 224),
    perp_age_group = na_if(perp_age_group, 940),
    perp_age_group = na_if(perp_age_group, "unknown"),
  ) %>%
  group_by(perp_age_group) %>%
  summarise(
    count = n()) %>%
  mutate(
    percentage = count / sum(count) * 100)
 
nypd_shooting_df %>%
   mutate(
    perp_sex = na_if(perp_sex, "u")) %>%
  group_by(perp_sex) %>%
  summarise(
    count = n()) %>%
  mutate(
    percentage = count / sum(count) * 100)
 
nypd_shooting_df %>%
  mutate(
    perp_race = recode(perp_race, "black hispanic" = "hispanic", "white hispanic" = "hispanic"), 
    perp_race = na_if(perp_race, "unknown")
  ) %>%
  group_by(perp_race) %>%
  summarise(
    count = n()) %>%
  mutate(
    percentage = count / sum(count) * 100)
 
nypd_shooting_df %>%
  group_by(vic_age_group) %>%
  mutate(
    vic_age_group = na_if(vic_age_group, "unknown")
  ) %>%
  summarise(
    count = n()) %>%
  mutate(
    percentage = count / sum(count) * 100)
 
nypd_shooting_df %>%
  group_by(vic_sex) %>%
  mutate(
    vic_sex = na_if(vic_sex, "u")) %>%
  summarise(
    count = n()) %>%
  mutate(
    percentage = count / sum(count) * 100)
 
nypd_shooting_df %>%
   mutate(
    vic_race = recode(vic_race, "black hispanic" = "hispanic", "white hispanic" = "hispanic"), 
    vic_race = na_if(vic_race, "unknown")
  ) %>%
  group_by(vic_race) %>%
  summarise(
    count = n()) %>%
  mutate(
    percentage = count / sum(count) * 100)
```
 
